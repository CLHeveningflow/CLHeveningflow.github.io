<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>LLVM 1:Clang入门 | Eveningflow&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="[TOC] #LLVM是什么 LLVM项目是可重用(reusable)、模块化(modular)的编译器以及工具链技术(toolchain technologies)的集合。有人将其理解为“底层虚拟机(Low Level Virtual Machine)”的简称，但是官方原话为：  “The name “LLVM” itself is not an acronym; it is the full">
<meta name="keywords" content="LLVM">
<meta property="og:type" content="article">
<meta property="og:title" content="LLVM 1:Clang入门">
<meta property="og:url" content="http://yoursite.com/2019/09/28/LLVM1/index.html">
<meta property="og:site_name" content="Eveningflow&#39;s Blog">
<meta property="og:description" content="[TOC] #LLVM是什么 LLVM项目是可重用(reusable)、模块化(modular)的编译器以及工具链技术(toolchain technologies)的集合。有人将其理解为“底层虚拟机(Low Level Virtual Machine)”的简称，但是官方原话为：  “The name “LLVM” itself is not an acronym; it is the full">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/1.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/2.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/3.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/4.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/5.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/6.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/7.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/8.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/10.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/10.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/11.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/12.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/13.jpg">
<meta property="og:image" content="http://yoursite.com/2019/09/28/LLVM1/14.jpg">
<meta property="og:updated_time" content="2019-10-12T02:55:13.618Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LLVM 1:Clang入门">
<meta name="twitter:description" content="[TOC] #LLVM是什么 LLVM项目是可重用(reusable)、模块化(modular)的编译器以及工具链技术(toolchain technologies)的集合。有人将其理解为“底层虚拟机(Low Level Virtual Machine)”的简称，但是官方原话为：  “The name “LLVM” itself is not an acronym; it is the full">
<meta name="twitter:image" content="http://yoursite.com/2019/09/28/LLVM1/1.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Eveningflow&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Eveningflow&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">人可以像blog一样简单</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-LLVM1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/28/LLVM1/" class="article-date">
  <time datetime="2019-09-28T14:39:01.000Z" itemprop="datePublished">2019-09-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      LLVM 1:Clang入门
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<p>#LLVM是什么</p>
<p>LLVM项目是可重用(reusable)、模块化(modular)的编译器以及工具链技术(toolchain technologies)的集合。有人将其理解为“底层虚拟机(Low Level Virtual Machine)”的简称，但是<a href="https://llvm.org/" target="_blank" rel="noopener">官方</a>原话为：</p>
<blockquote>
<p>“The name “LLVM” itself is not an acronym; it is the full name of the project.”</p>
</blockquote>
<p>意思是：LLVM不是首字母缩写，而是这整个项目的全名。</p>
<p>LLVM项目的发展起源于2000年伊利诺伊大学厄巴纳-香槟分校维克拉姆·艾夫（Vikram Adve）与克里斯·拉特纳（Chris Lattner）的研究，他们想要为所有静态及动态语言创造出动态的编译技术。2005年，苹果计算机雇用了克里斯·拉特纳及他的团队为苹果计算机开发应用程序系统[3]，LLVM为现今Mac OS X及iOS开发工具的一部分。</p>
<p>#1.LLVM&amp;&amp;clang安装</p>
<p>官网安装教程在<a href="http://clang.llvm.org/get_started.html" target="_blank" rel="noopener">这里</a>。这里简单介绍一下。</p>
<p>##1.1Linux环境</p>
<p>###1.1.1 安装前注意事项</p>
<p>由于本人使用的是虚拟机，所以在创建虚拟机的时候需要分配较大的内存和磁盘空间。这里踩了很多坑。</p>
<p>###1.1.2 下载有关库</p>
<pre><code>$ sudo apt-get install cmake
$ sudo apt-get install git
$ sudo apt-get install gcc
$ sudo apt-get install g++</code></pre><p>###1.1.3 下载项目源码</p>
<p>可以选择直接git整个工程，也可以去<a href="http://releases.llvm.org/download.html" target="_blank" rel="noopener">官网</a>下载源码然后自行安装。这里就按官网的git方法。</p>
<pre><code>$ git clone https://github.com/llvm/llvm-project.git</code></pre><p>下载好后会在当前目录下看到llvm-project文件夹。</p>
<p><img src="/2019/09/28/LLVM1/1.jpg" alt="LLVM"></p>
<p>###1.1.4 构建项目</p>
<pre><code>$ cd llvm-project</code></pre><p>创建构建目录</p>
<pre><code>$ mkdir build
$ cd build</code></pre><p>利用cmake构建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cmake -G &lt;generator&gt; [options] ../llvm</span><br></pre></td></tr></table></figure>

<p>常用的generator有：</p>
<ul>
<li>Ninja ——生成Ninja 文件</li>
<li>Unix Makefiles ——生成兼容make的makefile文件</li>
<li>Visual Studio ——生成Visual Studio项目与解决方案</li>
<li>Xcode ——用于生成Xcode项目</li>
</ul>
<p>个人使用Unix Makefiles</p>
<p>常用的options有：</p>
<ul>
<li><p>DCMAKE_INSTALL_PREFIX=directory ——为目录指定要在其中安装LLVM工具和库的完整路径名（默认/usr/local）。</p>
</li>
<li><p>DCMAKE_BUILD_TYPE=type ——type选项有Debug，Release，RelWithDebInfo和MinSizeRel。默认值为Debug。</p>
</li>
<li><p>DLLVM_ENABLE_ASSERTIONS=On ——启用断言检查进行编译。</p>
</li>
<li><p>DLLVM_ENABLE_PROJECTS=”…” ——要另外构建的LLVM子项目的列表，以’;’分隔。例如要构建LLVM，Clang，libcxx和libcxxabi，使用:</p>
<pre><code>DLLVM_INSTALL_PROJECTS=&quot;clang;libcxx;libcxxabi&quot;</code></pre></li>
<li><p>DLLVM_TARGETS_TO_BUILD=”…” ——构建针对的平台的部分项目，以’;’分隔。默认面向所有平台编译(all)，指定只编译自己需要的CPU架构可以节省时间。</p>
</li>
</ul>
<p>官方文档在<a href="http://llvm.org/docs/CMake.html#options-and-variables" target="_blank" rel="noopener">这</a>。</p>
<p>由于全部构建真的很耗费资源和时间，我使用的构建clang命令（可供参考）：</p>
<pre><code>$ cmake -DCMAKE_BUILD_TYPE=Release -DLLVM_TARGETS_TO_BUILD=&quot;X86&quot; -DLLVM_ENABLE_PROJECTS=clang -DLLVM_USE_LINKER=gold -G &quot;Unix Makefiles&quot; ../llvm</code></pre><p>当然你如果愿意（<del>而且设备跑得动</del>）也可以：<br>    $ cmake -G “Unix Makefiles” ../llvm</p>
<p>###1.1.5 编译</p>
<pre><code>$ make [-j &lt;core&gt;]
$ sudo make install</code></pre><p>直接make也可以，但LLVM也支持并行编译，其中core取决于核心数。如：<br>    $ make -j 4</p>
<p>这两步一般会很久……</p>
<p>###1.1.6 测试</p>
<p>在编译结束后尝试在命令行中使用clang：</p>
<pre><code>$ clang -v</code></pre><p>本人得到结果如下：</p>
<pre><code>clang version 10.0.0 
Target: x86_64-unknown-linux-gnu
Thread model: posix
InstalledDir: /usr/local/bin
Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/7
Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/7.4.0
Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/8
Selected GCC installation: /usr/lib/gcc/x86_64-linux-gnu/7.4.0
Candidate multilib: .;@m64
Selected multilib: .;@m64</code></pre><img src="/2019/09/28/LLVM1/2.jpg" width="60%" align="left">

<p>编写一段C语言代码试试看(C++也可以):</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//helloworld.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"hello world\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用clang编译：</p>
<pre><code>$ clang helloworld.c -o hello.out
$ ./hello.out</code></pre><p>如果是C++代码则：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//helloworld.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"hello world"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用clang编译（注意命令是clang++，本人刚开始只写clang提示编译错误…）：</p>
<pre><code>$ clang++ helloworld.cpp -o hello.out
$ ./hello.out</code></pre><img src="/2019/09/28/LLVM1/3.jpg" width="60%" align="left">

<p>大功告成！</p>
<p>##1.2.Windows环境</p>
<p>llvm+clang在windows下有两种类型，一种利用mingw编译，使用gcc的库和头文件；另一种利用vc编译，使用vc的库和头文件。推荐使用vc编译的版本，因为其程序更原生且不依赖于mingw，而只依赖于vc的dll库。</p>
<p>具体步骤<a href="http://clang.llvm.org/get_started.html" target="_blank" rel="noopener">官方的教程</a>已经说得很明白啦，下面简单整理介绍一下。</p>
<p>###1.2.1 安装工具</p>
<ul>
<li><strong>Git.</strong> 下载源代码。下载地址：<a href="https://git-scm.com/download" target="_blank" rel="noopener">https://git-scm.com/download</a></li>
<li><strong>Cmake.</strong> 用于生成Visual Studio的解决方案和项目文件。下载地址：<a href="https://cmake.org/download/" target="_blank" rel="noopener">https://cmake.org/download/</a></li>
<li><strong>Visual Studio(推荐2017或之后版本).</strong> 生成项目的容器。</li>
<li><strong>Python.</strong> 用于运行clang测试套件。下载地址：<a href="https://www.python.org/download/" target="_blank" rel="noopener">https://www.python.org/download/</a></li>
<li><strong>GnuWin32 tools.</strong> clang和LLVM的测试套件需要GNU工具。下载地址：<a href="http://getgnuwin32.sourceforge.net/" target="_blank" rel="noopener">http://getgnuwin32.sourceforge.net/</a></li>
</ul>
<p>###1.2.2 clone项目源代码</p>
<p>你也可以选择去github上直接download。</p>
<pre><code>$ git clone https://github.com/llvm/llvm-progect.git</code></pre><p>####1.2.3 Cmake编译<br>在项目总目录下新建build目录（避免污染项目源代码）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir build</span><br><span class="line">$ cd build</span><br></pre></td></tr></table></figure>

<p>运行Cmake。<br>    $ cmake -DLLVM_ENABLE_PROJECTS=clang -G “Visual Studio 15 2017” -A x64 -Thost=x64 ..\llvm</p>
<ul>
<li>如果使用Visual Studio 2019则改为-G “Visual Studio 16 2019”。</li>
<li>如果需要适配x86则改为 -A Win32。</li>
</ul>
<p>###1.2.4 构建build</p>
<p>在Visual Studio中打开LLVM.sin，右击ALL_BUILD项目，选择生成，等待数小时。</p>
<p>###1.2.5 设置环境变量</p>
<p>将llvm/debug/bin 添加到自己的环境变量中。</p>
<p>其余具体测试步骤请看<a href="http://clang.llvm.org/hacking.html#testingWindows" target="_blank" rel="noopener">Hacking on clang - Testing using Visual Studio on Windows</a>。</p>
<p>有待补充…</p>
<p>#2.LLVM简介</p>
<p>用户文档：<a href="https://llvm.org/docs/LangRef.html" target="_blank" rel="noopener">llvm.org/docs/LangRef.html</a></p>
<p>LLVM是基于静态单一分配的表示形式，可提供类型安全性、底层操作、灵活性，并且适配几乎所有高级语言，具有通用的代码表示。现在LLVM已经成为多个编译器和代码生成相关子项目的母项目。</p>
<blockquote>
<p>The LLVM code representation is designed to be used in three different forms: as an in-memory compiler IR, as an on-disk bitcode representation (suitable for fast loading by a Just-In-Time compiler), and as a human readable assembly language representation. </p>
</blockquote>
<p>其中，LLVM提供了完整编译系统的中间层，并将中间语言（Intermediate Repressentation, IR）从编译器取出并进行最优化，最优化后的IR接着被转换及链接到目标平台的汇编语言。</p>
<p>我们知道，传统的编译器主要结构为：</p>
<p><img src="/2019/09/28/LLVM1/4.jpg" alt="LLVM" title="传统编译器结构，图片摘自网络"></p>
<p>Frontend：前端，词法分析、语法分析、语义分析、生成中间代码</p>
<p>Optimizer：优化器，进行中间代码优化</p>
<p>Backend：后端，生成机器码</p>
<p>LLVM主要结构为：</p>
<p><img src="/2019/09/28/LLVM1/5.jpg" alt="LLVM" title="LLVM结构，图片摘自网络"></p>
<p>也就是说，对于LLVM来说，不同的前后端使用统一的中间代码LLVM IR。如果需要支持一种新的编程语言/硬件设备，那么只需要实现一个新的前端/后端就可以了，而优化截断是一个通用的阶段，针对统一的LLVM IR，都不需要对于优化阶段修改。对比GCC，其前端和后端基本耦合在一起，所以GCC支持一门新的语言或者目标平台会变得很困难。</p>
<p>以下内容摘自维基百科：</p>
<blockquote>
<p>LLVM也可以在编译时期、链接时期，甚至是运行时期产生可重新定位的代码（Relocatable Code）。</p>
</blockquote>
<blockquote>
<p>LLVM支持与语言无关的指令集架构及类型系统。每个在静态单赋值形式（SSA）的指令集代表着，每个变量（被称为具有类型的寄存器）仅被赋值一次，这简化了变量间相依性的分析。LLVM允许代码被静态的编译，包含在传统的GCC系统底下，或是类似JAVA等后期编译才将IF编译成机器代码所使用的即时编译（JIT）技术。它的类型系统包含基本类型（整数或是浮点数）及五个复合类型（指针、数组、向量、结构及函数），在LLVM具体语言的类型建制可以以结合基本类型来表示，举例来说，C++所使用的class可以被表示为结构、函数及函数指针的数组所组成。</p>
</blockquote>
<blockquote>
<p>LLVM JIT编译器可以最优化在运行时期时程序所不需要的静态分支，这在一些部分求值（Partial Evaluation）的案例中相当有效，即当程序有许多选项，而在特定环境下其中多数可被判断为是不需要。这个特色被使用在Mac OS X Leopard（v10.5）底下OpenGL的管线，当硬件不支持某个功能时依然可以被成功地运作。OpenGL堆栈下的绘图程序被编译为IR，接着在机器上运行时被编译，当系统拥有高端GPU时，这段程序会进行极少的修改并将传递指令给GPU，当系统拥有低级的GPU时，LLVM将会编译更多的程序，使这段GPU无法运行的指令在本地端的中央处理器运行。LLVM增进了使用Intel GMA芯片等低端机器的性能。一个类似的系统发展于Gallium3D LLVMpipe，它已被合并到GNOME，使其可运行在没有GPU的环境。</p>
</blockquote>
<blockquote>
<p>根据2011年的一项测试，GCC在运行时期的性能平均比LLVM高10%。而2013年测试显示，LLVM可以编译出接近GCC相同性能的运行码。</p>
</blockquote>
<p>#3.Clang简介</p>
<p>Clang是LLVM针对C语言及其家族语言的前端(a C language family frontend for LLVM)。它的主要目标是提供一个GNU编译器套装（GCC）的替代品，支持GNU编译器大多数便已设置以及非官方语言拓展。项目包括Clang前端和Clang静态分析器。</p>
<blockquote>
<p>The Clang project provides a language front-end and tooling infrastructure for languages in the C language family (C, C++, Objective C/C++, OpenCL, CUDA, and RenderScript) for the LLVM project. Both a GCC-compatible compiler driver (clang) and an MSVC-compatible compiler driver (clang-cl.exe) are provided. You can get and build the source today.</p>
</blockquote>
<p>Clang项目为LLVM项目中的C语言家族提供了一个语言前端和工具基础设施。其提供了兼容GCC和MSVC的编译器驱动程序（clang和clang-cl.exe）。<br>官方手册：<a href="http://clang.llvm.org/docs/UsersManual.html#basicusage" target="_blank" rel="noopener">http://clang.llvm.org/docs/UsersManual.html#basicusage</a></p>
<p>针对于GCC，Clang的优点有：</p>
<ul>
<li>占用内存小</li>
<li>设计清晰简单，容易理解</li>
<li>编译速度快</li>
<li>设计偏向模块化，易于集成</li>
<li>诊断信息可读性强</li>
</ul>
<p>##Clang(Clang++)使用</p>
<p>我们先随便写一段以下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">10</span>] = &#123;<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; a[i] &lt;&lt; (i == <span class="number">9</span>?<span class="string">"\n"</span>:<span class="string">" "</span>);</span><br><span class="line">	sort(a,a+<span class="number">10</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; a[i] &lt;&lt; (i == <span class="number">9</span>?<span class="string">"\n"</span>:<span class="string">" "</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2019/09/28/LLVM1/6.jpg" width="50%" height="50%" align="left">

<p>###3.1.生成预处理文件：</p>
<pre><code>$ clang++ -E test.cpp -o test.i</code></pre><p>生成文件test.i（部分）如下：</p>
<img src="/2019/09/28/LLVM1/7.jpg" width="70%" height="70%" align="left">

<p>###3.2.生成汇编程序：</p>
<pre><code>$ clang++ -S test.i</code></pre><p><img src="/2019/09/28/LLVM1/8.jpg" alt="LLVM"></p>
<p>###3.3.生成目标文件：</p>
<pre><code>$ clang++ -c test.s</code></pre><img src="/2019/09/28/LLVM1/10.jpg" width="50%" height="50%" align="left">

<p>###3.4.生成可执行文件：</p>
<pre><code>$ clang++ -o test.out test.o</code></pre><img src="/2019/09/28/LLVM1/10.jpg" width="50%" height="50%" align="left">

<p>emm…<del>和GCC大致还是一样的嘛</del> 非常的好用。</p>
<p>###3.5.查看Clang编译的过程</p>
<pre><code>$ clang -ccc-print-phases A.c</code></pre><img src="/2019/09/28/LLVM1/11.jpg" width="50%" height="50%" align="left">

<ul>
<li>0.获取输入：A.c文件，C语言</li>
<li>1.预处理器：处理define、include等</li>
<li>2.编译：生成中间代码（IR）</li>
<li>3.后端：生成汇编代码</li>
<li>4.汇编：生成目标代码</li>
<li>5.链接器：链接其他动态库</li>
</ul>
<p>###3.6.词法分析</p>
<pre><code>$ clang -fmodules -E -Xclang -dump-tokens A.c</code></pre><p>如图，写一个小函数对其进行词法分析。</p>
<img src="/2019/09/28/LLVM1/12.jpg" width="60%" align="left">

<p>###3.7.语法分析</p>
<pre><code>$ clang -fmodules -fsyntax-only -Xclang -ast-dump A.c</code></pre><p>生成语法树如下：</p>
<img src="/2019/09/28/LLVM1/13.jpg" width="80%" align="left">

<p>有颜色区分还是比较美观的。</p>
<p>###3.8.语义分析</p>
<p>生成LLVM IR。LLVM IR有3种表示形式（本质是等价的）</p>
<ul>
<li>(1).text:便于阅读的文本格式，类似于汇编语言，拓展名.ll</li>
<li>(2).memory:内存格式</li>
<li>(3).bitcode:二进制格式，拓展名.bc</li>
</ul>
<p>生成text格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ clang -S -emit-llvm A.c</span><br></pre></td></tr></table></figure>

<img src="/2019/09/28/LLVM1/14.jpg" width="70%" height="70%" div align="left">



<p>#4.学习体会</p>
<p>安装LLVM绝对是一件痛苦的事情，我在Linux上安装LLVM+Clang起码花费有40小时（Windows上还没有成功55555）读了很久文档才搞清楚cmake的各种选项的用处，然后就是漫长的等待…</p>
<p>对编译原理的学习才刚刚起步，读了一下Clang的用户文档，很多选项都<del>搞不明白，</del>没有机会使用，但是经过使用后感觉LLVM真的是一个很强大的模块化编译器工具集合，而Clang的各种编译选项确实可以帮助理解编译的各个流程，光听编译原理课程是看不见一个实际的编译器是如何生成词法分析、语法分析的结果或者中间代码的。</p>
<p>LLVM不仅仅是编译器那么简单，我们可以利用其做各种NB的操作，比如开发新的编译器、新的编程语言、开发编译器插件、进行代码规范检查。它也绝对不是IOS领域特有的，因为它是一个高度模块化、可重用的组件，可适用于多门编程语言和多个硬件设备平台。可以说，大部分从事计算机工作的人都该懂点LLVM，而绝不仅仅只是开发者。</p>
<p>友情链接：</p>
<p>LLVM官网：<a href="http://llvm.org" target="_blank" rel="noopener">http://llvm.org</a></p>
<p>Clang官网：<a href="http://clang.llvm.org" target="_blank" rel="noopener">http://clang.llvm.org</a></p>
<p>LLVM用户文档：<a href="https://llvm.org/docs/LangRef.html" target="_blank" rel="noopener">llvm.org/docs/LangRef.html</a></p>
<p>Clang用户文档：<a href="http://clang.llvm.org/docs/UsersManual.html" target="_blank" rel="noopener">http://clang.llvm.org/docs/UsersManual.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/28/LLVM1/" data-id="ck1myydzl0000g02uuv0jf1px" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LLVM/">LLVM</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/09/26/hello,world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/LLVM/">LLVM</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/LLVM/" style="font-size: 10px;">LLVM</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/28/LLVM1/">LLVM 1:Clang入门</a>
          </li>
        
          <li>
            <a href="/2019/09/26/hello,world/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Eveningflow<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>